name: üõ°Ô∏è Anali Security Scan (DockerHub - adityapal404/anali)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  anali_scan:
    name: Run Anali Agent in Docker (from DockerHub)
    runs-on: ubuntu-latest

    steps:
      # -------------------------------------------------------------
      # STEP 1: Checkout repository (the target code to scan)
      # -------------------------------------------------------------
      - name: Checkout Repository
        uses: actions/checkout@v4

      # -------------------------------------------------------------
      # STEP 2: (Optional) Login to DockerHub if image is private
      # -------------------------------------------------------------
      # Uncomment below only if your image is private
      # - name: DockerHub Login
      #   uses: docker/login-action@v3
      #   with:
      #     username: ${{ secrets.DOCKERHUB_USERNAME }}
      #     password: ${{ secrets.DOCKERHUB_TOKEN }}

      # -------------------------------------------------------------
      # STEP 3: Pull your Docker image from DockerHub
      # -------------------------------------------------------------
      - name: Pull Anali Agent Image from DockerHub
        run: docker pull adityapal404/anali:latest

      # -------------------------------------------------------------
      # STEP 4: Run the Anali scan inside the container
      # -------------------------------------------------------------
      - name: Run Security Scan
        run: |
          mkdir -p reports
          docker run --rm \
            -v ${{ github.workspace }}:/scan \
            -v ${{ github.workspace }}/reports:/reports \
            adityapal404/anali:latest \
            --path /scan
        continue-on-error: true

      # -------------------------------------------------------------
      # STEP 5: Upload results as GitHub Action artifacts
      # -------------------------------------------------------------
      - name: Upload Security Reports
        uses: actions/upload-artifact@v4
        with:
          name: anali-scan-report
          path: reports/
          retention-days: 30
